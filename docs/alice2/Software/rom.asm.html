<html>
<head>
<title>C:\Documents and Settings\kestelootl\My Documents\Alice\alice.noimages.tar\alice\alice2\Software\rom.asm.html</title>
<meta name="Generator" content="Vim/6.0">
</head>
<body bgcolor="#ffdab9" text="#000000">
<pre>
<font color="#cd00cd">#undef </font>SLOWCLOCK   <font color="#406090">; Defined if we are running slow</font>
<font color="#cd00cd">#undef </font>NOPRINT     <font color="#406090">; Defined to turn off printing</font>

<font color="#406090">; library.asm must be first!</font>
<font color="#cd00cd">#include </font><font color="#c00058">&quot;library.asm&quot;</font>

<font color="#cd00cd">#include </font><font color="#c00058">&quot;stdio.asm&quot;</font>
<font color="#cd00cd">#include </font><font color="#c00058">&quot;string.asm&quot;</font>

PIC_COMMAND     <font color="#cd00cd">EQU</font>     <font color="#c00058">08000H</font>
NUMKEY          <font color="#cd00cd">EQU</font>     <font color="#c00058">08001H</font>
PICBYTE         <font color="#cd00cd">EQU</font>     <font color="#c00058">08003H</font>
SHIFT_STATUS    <font color="#cd00cd">EQU</font>     <font color="#c00058">08004H</font>
CTRL_STATUS     <font color="#cd00cd">EQU</font>     <font color="#c00058">08005H</font>
ALT_STATUS      <font color="#cd00cd">EQU</font>     <font color="#c00058">08006H</font>
UPKEY_FLAG      <font color="#cd00cd">EQU</font>     <font color="#c00058">08007H</font>
CURRENT_CMD     <font color="#cd00cd">EQU</font>     <font color="#c00058">08008H</font>
CURRENT_ADDR    <font color="#cd00cd">EQU</font>     <font color="#c00058">08009H</font> <font color="#406090">; two bytes</font>
CURRENT_LEN     <font color="#cd00cd">EQU</font>     <font color="#c00058">0800BH</font>
CURRENT_PTR     <font color="#cd00cd">EQU</font>     <font color="#c00058">0800CH</font> <font color="#406090">; point into CURRENT_CMD</font>
SHOULD_RUN      <font color="#cd00cd">EQU</font>     <font color="#c00058">0800DH</font>
KEYBUF          <font color="#cd00cd">EQU</font>     <font color="#c00058">0A000H</font>
INPUT_BUF       <font color="#cd00cd">EQU</font>     <font color="#c00058">0C000H</font>
OUTPUT_BUF      <font color="#cd00cd">EQU</font>     <font color="#c00058">0C040H</font>

LSHIFT_KEY      <font color="#cd00cd">EQU</font>     <font color="#c00058">012H</font>
RSHIFT_KEY      <font color="#cd00cd">EQU</font>     <font color="#c00058">059H</font>
CTRL_KEY        <font color="#cd00cd">EQU</font>     <font color="#c00058">014H</font>
ALT_KEY         <font color="#cd00cd">EQU</font>     <font color="#c00058">011H</font>
UP_KEY          <font color="#cd00cd">EQU</font>     <font color="#c00058">0F0H</font>
EXT_KEY         <font color="#cd00cd">EQU</font>     <font color="#c00058">0E0H</font>
EXT2_KEY        <font color="#cd00cd">EQU</font>     <font color="#c00058">0E1H</font>

PIC_NON_CMD     <font color="#cd00cd">EQU</font>     <font color="#c00058">000H</font>
PIC_SER_CMD     <font color="#cd00cd">EQU</font>     <font color="#c00058">001H</font>
PIC_KBD_CMD     <font color="#cd00cd">EQU</font>     <font color="#c00058">002H</font>
PIC_TIM_CMD     <font color="#cd00cd">EQU</font>     <font color="#c00058">003H</font>

CMD_SEND        <font color="#cd00cd">EQU</font>     <font color="#c00058">001H</font>
CMD_RUN         <font color="#cd00cd">EQU</font>     <font color="#c00058">002H</font>
CMD_MAX         <font color="#cd00cd">EQU</font>     <font color="#c00058">003H</font>    <font color="#406090">; one past max value of a command</font>


<font color="#406090">;----------------------------------------</font>

<font color="#406090">;</font>
<font color="#406090">; Memory test program</font>
<font color="#406090">;</font>

MAIN
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, INTROSTR
        <font color="#804040"><b>CALL</b></font>    LCDPRINT

<font color="#406090">;</font>
<font color="#406090">; Setup the 8259</font>
<font color="#406090">;</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">016H</font>    <font color="#406090">; F = 1, S = 1</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">03FH</font>    <font color="#406090">; Table is at 03F00H</font>
        <font color="#804040"><b>OUT</b></font>     (I8259B), <font color="#008080">A</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">0F0H</font>    <font color="#406090">; Enable lower 4 IRQs</font>
        <font color="#804040"><b>OUT</b></font>     (I8259B), <font color="#008080">A</font>

<font color="#406090">;</font>
<font color="#406090">; Initialize our variables</font>
<font color="#406090">;</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      (PIC_COMMAND), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (NUMKEY), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (SHIFT_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (CTRL_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (ALT_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (UPKEY_FLAG), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (CURRENT_PTR), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (SHOULD_RUN), <font color="#008080">A</font>

<font color="#406090">;</font>
<font color="#406090">; Read a byte from the pic in case it triggered</font>
<font color="#406090">; an interrupt before we were ready (keyboard</font>
<font color="#406090">; reset).  This resets the PIC interrupt line.</font>
<font color="#406090">;</font>
<font color="#406090">; The command read routine throws away commands it does not understand,</font>
<font color="#406090">; so it is likely we will get the keyboard init status byte here but the</font>
<font color="#406090">; command read routine will chuck it and we will catch up on the next byte.</font>
<font color="#406090">;</font>

        <font color="#804040"><b>IN</b></font>      <font color="#008080">A</font>, (PIC)

<font color="#406090">;</font>
<font color="#406090">; Setup interrupt mode 0</font>
<font color="#406090">;</font>

        <font color="#804040"><b>IM</b></font>      <font color="#c00058">0</font>
        <font color="#804040"><b>EI</b></font>

<font color="#406090">;</font>
<font color="#406090">; Go, go, go!</font>
<font color="#406090">;</font>

PRINTAGAIN
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, PLEASESTR
        <font color="#804040"><b>CALL</b></font>    LCDPRINT

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, INPUT_BUF
        <font color="#804040"><b>CALL</b></font>    GETS

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, HELLOSTR
        <font color="#804040"><b>LD</b></font>      <font color="#008080">IX</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    STRCPY

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, INPUT_BUF
        <font color="#804040"><b>CALL</b></font>    STRCPY

        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), PAUSE
        <font color="#804040"><b>INC</b></font>     <font color="#008080">IX</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), <font color="#c00058">0</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    LCDPRINT

        <font color="#804040"><b>JP</b></font>      PRINTAGAIN

<font color="#406090">;----------------------------------------</font>

ISR0    <font color="#406090">; PIC interrupt</font>

        <font color="#406090">;</font>
        <font color="#406090">; The PIC sends a command byte followed by an</font>
        <font color="#406090">; optional data byte.</font>
        <font color="#406090">;</font>
        <font color="#406090">;   Command byte: PIC_SER_CMD</font>
        <font color="#406090">;   Data byte: serial byte in ASCII</font>
        <font color="#406090">;</font>
        <font color="#406090">;   Command byte: PIC_KBD_CMD</font>
        <font color="#406090">;   Data byte: keyboard byte as scan code</font>
        <font color="#406090">;</font>
        <font color="#406090">;   Command byte: PIC_TIM_CMD</font>
        <font color="#406090">;   Data byte: none</font>
        <font color="#406090">;</font>
        <font color="#406090">; Current command is stored in PIC_COMMAND, which is</font>
        <font color="#406090">; equal to PIC_NON_CMD if we are waiting for a command.</font>
        <font color="#406090">;</font>

        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>IN</b></font>      <font color="#008080">A</font>, (PIC)
        <font color="#804040"><b>LD</b></font>      (PICBYTE), <font color="#008080">A</font>

<font color="#406090">; START TEST</font>
<font color="#cd00cd">#if </font><font color="#c00058">0</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">IX</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">HL</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">IX</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    PHEXBYTE        <font color="#406090">; Hex A into IX</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, KEYBUF
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (NUMKEY)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>          <font color="#406090">; HL = pointer into buffer</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (NUMKEY), <font color="#008080">A</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (OUTPUT_BUF) <font color="#406090">; Key in A</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>         <font color="#406090">; Stick our letter in buffer</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, KEYBUF
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (NUMKEY)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>          <font color="#406090">; HL = pointer into buffer</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (NUMKEY), <font color="#008080">A</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (OUTPUT_BUF+<font color="#c00058">1</font>)<font color="#406090">; Key in A</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>         <font color="#406090">; Stick our letter in buffer</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">BC</font>
        <font color="#804040"><b>POP</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>POP</b></font>     <font color="#008080">IX</font>

        <font color="#804040"><b>JP</b></font>      ISR0_END
<font color="#cd00cd">#endif</font>
<font color="#406090">; END TEST</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PIC_COMMAND)
        <font color="#804040"><b>CP</b></font>      PIC_NON_CMD     <font color="#406090">; Cmd not read yet</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, ISR0_IS_COMMAND

        <font color="#804040"><b>CP</b></font>      PIC_SER_CMD
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, ISR0_IS_SERIAL

        <font color="#804040"><b>CP</b></font>      PIC_KBD_CMD
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, ISR0_IS_KEYBOARD

        <font color="#804040"><b>JP</b></font>      ISR0_RESET      <font color="#406090">; Whoa, bad byte</font>

ISR0_IS_COMMAND
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)
        <font color="#804040"><b>CP</b></font>      PIC_TIM_CMD     <font color="#406090">; special case for timer cause no data</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, ISR0_IS_TIMER

        <font color="#804040"><b>LD</b></font>      (PIC_COMMAND), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      ISR0_END

ISR0_IS_TIMER
        <font color="#406090">; do something</font>
        <font color="#804040"><b>JP</b></font>      ISR0_RESET

ISR0_IS_SERIAL
        <font color="#804040"><b>CALL</b></font>    HANDLE_SERIAL
        <font color="#804040"><b>JP</b></font>      ISR0_RESET

ISR0_IS_KEYBOARD
        <font color="#804040"><b>CALL</b></font>    HANDLE_KEYBOARD
        <font color="#804040"><b>JP</b></font>      ISR0_RESET

ISR0_RESET
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, PIC_NON_CMD
        <font color="#804040"><b>LD</b></font>      (PIC_COMMAND), <font color="#008080">A</font>
        <font color="#406090">; FALLTHROUGH</font>

ISR0_END
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

HANDLE_SERIAL  <font color="#406090">; trashes A</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">HL</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">BC</font>

        <font color="#406090">; we get downloaded programs through serial.  handle</font>
        <font color="#406090">; that first.  we get one command byte, then two</font>
        <font color="#406090">; address bytes, then a length byte.  if the command</font>
        <font color="#406090">; is CMD_SEND, then this header is followed by &quot;length&quot;</font>
        <font color="#406090">; bytes to stick into &quot;address&quot;.  if the command is</font>
        <font color="#406090">; CMD_RUN, then the length is zero and SHOULD_RUN is</font>
        <font color="#406090">; set to 1, which causes the input routine to jump</font>
        <font color="#406090">; to the address in CURRENT_ADDR.</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CURRENT_PTR)
        <font color="#804040"><b>CP</b></font>      <font color="#c00058">3</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, GET_CMD_HEADER

        <font color="#406090">; just got last byte of header</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CURRENT_CMD)
        <font color="#804040"><b>CP</b></font>      CMD_RUN
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, GET_CMD_HEADER

        <font color="#406090">; ignore length and run</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">1</font>
        <font color="#804040"><b>LD</b></font>      (SHOULD_RUN), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      END_HANDLE_SERIAL

GET_CMD_HEADER
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CURRENT_PTR)
        <font color="#804040"><b>CP</b></font>      <font color="#c00058">4</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, TRANSFER_BYTE

        <font color="#406090">; check if it is not a transfer</font>
        <font color="#804040"><b>CP</b></font>      <font color="#c00058">0</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, TRANSFER_HEADER

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)
        <font color="#804040"><b>CP</b></font>      CMD_MAX
        <font color="#804040"><b>JP</b></font>      P, SIMULATE_KEYBOARD <font color="#406090">; &gt;= CMD_MAX</font>

TRANSFER_HEADER
        <font color="#406090">; transfer into the header</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, CURRENT_CMD
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CURRENT_PTR)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">C</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#008080">C</font>
        <font color="#804040"><b>LD</b></font>      (CURRENT_PTR), <font color="#008080">A</font>

        <font color="#804040"><b>JP</b></font>      END_HANDLE_SERIAL

TRANSFER_BYTE
        <font color="#406090">; transfer into RAM</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, (CURRENT_ADDR)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>LD</b></font>      (CURRENT_ADDR), <font color="#008080">HL</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CURRENT_LEN)
        <font color="#804040"><b>DEC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (CURRENT_LEN), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, END_HANDLE_SERIAL

        <font color="#804040"><b>LD</b></font>      (CURRENT_PTR), <font color="#008080">A</font>

        <font color="#804040"><b>JP</b></font>      END_HANDLE_SERIAL

SIMULATE_KEYBOARD
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, KEYBUF
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (NUMKEY)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>          <font color="#406090">; HL = pointer into buffer</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (NUMKEY), <font color="#008080">A</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)    <font color="#406090">; Key in A</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>         <font color="#406090">; Stick our letter in buffer</font>

END_HANDLE_SERIAL

        <font color="#804040"><b>POP</b></font>     <font color="#008080">BC</font>
        <font color="#804040"><b>POP</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

HANDLE_KEYBOARD
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">HL</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (PICBYTE)    <font color="#406090">; Get the byte</font>

        <font color="#804040"><b>CP</b></font>      UP_KEY          <font color="#406090">; Key-up is preceded by UP_KEY</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, NOT_UP_KEY

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">1</font>
        <font color="#804040"><b>LD</b></font>      (UPKEY_FLAG), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      END_HANDLE_KEYBOARD

NOT_UP_KEY
        <font color="#804040"><b>CP</b></font>      EXT_KEY         <font color="#406090">; Extended keys preceded by EXT_KEY</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, DID_KEY      <font color="#406090">; For now just ignore</font>

        <font color="#804040"><b>CP</b></font>      EXT2_KEY        <font color="#406090">; Break preceded by EXT2_KEY</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, DID_KEY      <font color="#406090">; For now just ignore</font>

        <font color="#804040"><b>BIT</b></font>     <font color="#c00058">7</font>, <font color="#008080">A</font>            <font color="#406090">; See if high bit is on</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, DID_KEY     <font color="#406090">; Ignore if &gt;= 128</font>

        <font color="#804040"><b>CP</b></font>      LSHIFT_KEY      <font color="#406090">; See if it is a shift key</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, IS_SHIFT
        <font color="#804040"><b>CP</b></font>      RSHIFT_KEY
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, NOT_SHIFT
IS_SHIFT
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (UPKEY_FLAG)
        <font color="#804040"><b>XOR</b></font>     <font color="#c00058">1</font>
        <font color="#804040"><b>LD</b></font>      (SHIFT_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      DID_KEY

NOT_SHIFT
        <font color="#804040"><b>CP</b></font>      CTRL_KEY        <font color="#406090">; See if it is a control key</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, NOT_CTRL

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (UPKEY_FLAG)
        <font color="#804040"><b>XOR</b></font>     <font color="#c00058">1</font>
        <font color="#804040"><b>LD</b></font>      (CTRL_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      DID_KEY

NOT_CTRL
        <font color="#804040"><b>CP</b></font>      ALT_KEY         <font color="#406090">; See if it is an alt key</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">NZ</font>, NOT_ALT

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (UPKEY_FLAG)
        <font color="#804040"><b>XOR</b></font>     <font color="#c00058">1</font>
        <font color="#804040"><b>LD</b></font>      (ALT_STATUS), <font color="#008080">A</font>
        <font color="#804040"><b>JP</b></font>      DID_KEY

NOT_ALT
        <font color="#804040"><b>LD</b></font>      <font color="#008080">L</font>, <font color="#008080">A</font>            <font color="#406090">; HL = A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">H</font>, <font color="#c00058">0</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (UPKEY_FLAG) <font color="#406090">; Ignore all other key ups</font>
        <font color="#804040"><b>CP</b></font>      <font color="#c00058">1</font>
        <font color="#804040"><b>JP</b></font>      <font color="#008080">Z</font>, DID_KEY

        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">HL</font>          <font color="#406090">; HL *= 4</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">HL</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (SHIFT_STATUS)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (CTRL_STATUS)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (ALT_STATUS)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">BC</font>, KEY_XLAT    <font color="#406090">; Translation table</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (<font color="#008080">HL</font>)         <font color="#406090">; Get actual key</font>
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, KEYBUF
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (NUMKEY)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">C</font>, <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">B</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>ADD</b></font>     <font color="#008080">HL</font>, <font color="#008080">BC</font>          <font color="#406090">; HL = pointer into buffer</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      (NUMKEY), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>              <font color="#406090">; Key in A</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>         <font color="#406090">; Stick our ASCII letter in there</font>


DID_KEY
        <font color="#406090">; Reset &quot;up&quot; flag</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      (UPKEY_FLAG), <font color="#008080">A</font>

END_HANDLE_KEYBOARD

        <font color="#804040"><b>POP</b></font>     <font color="#008080">BC</font>
        <font color="#804040"><b>POP</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR1
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR2
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR3
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR4
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR5
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR6
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;------------------</font>

ISR7
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">AF</font>

        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">020H</font>         <font color="#406090">; End of Interrupt</font>
        <font color="#804040"><b>OUT</b></font>     (I8259A), <font color="#008080">A</font>

        <font color="#804040"><b>POP</b></font>     <font color="#008080">AF</font>
        <font color="#804040"><b>EI</b></font>
        <font color="#804040"><b>RET</b></font>

<font color="#406090">;----------------------------------------</font>

INTROSTR        <font color="#cd00cd">DB</font>      <font color="#c00058">&quot;PIC16C64 test&quot;</font>, <font color="#c00058">10</font>, <font color="#c00058">0</font>

PLEASESTR       <font color="#cd00cd">DB</font>      <font color="#c00058">&quot;Your name?&quot;</font>, <font color="#c00058">10</font>, <font color="#c00058">0</font>
HELLOSTR        <font color="#cd00cd">DB</font>      <font color="#c00058">&quot;Hello &quot;</font>, <font color="#c00058">0</font>

KEY_XLAT        <font color="#406090">; Normal, shift, ctrl, alt</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>  <font color="#406090">; F9</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>  <font color="#406090">; F5</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>  <font color="#406090">; F3</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>  <font color="#406090">; F1</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>  <font color="#406090">; F2</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>  <font color="#406090">; F12</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>  <font color="#406090">; F10</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>  <font color="#406090">; F8</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>  <font color="#406090">; F6</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>  <font color="#406090">; F4</font>
        <font color="#cd00cd">DB</font>         <font color="#c00058">9</font>,   <font color="#c00058">9</font>,   <font color="#c00058">9</font>,   <font color="#c00058">9</font>  <font color="#406090">; Tab</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'`'</font>, <font color="#c00058">'~'</font>, <font color="#c00058">'`'</font>, <font color="#c00058">'`'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Alt</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Left shift</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Control</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'q'</font>, <font color="#c00058">'Q'</font>,  <font color="#c00058">17</font>,  <font color="#c00058">17</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'!'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'z'</font>, <font color="#c00058">'Z'</font>,  <font color="#c00058">26</font>,  <font color="#c00058">26</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'s'</font>, <font color="#c00058">'S'</font>,  <font color="#c00058">19</font>,  <font color="#c00058">19</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'a'</font>, <font color="#c00058">'A'</font>,   <font color="#c00058">1</font>,   <font color="#c00058">1</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'w'</font>, <font color="#c00058">'W'</font>,  <font color="#c00058">23</font>,  <font color="#c00058">23</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'2'</font>, <font color="#c00058">'@'</font>, <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'c'</font>, <font color="#c00058">'C'</font>,   <font color="#c00058">3</font>,   <font color="#c00058">3</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'x'</font>, <font color="#c00058">'X'</font>,  <font color="#c00058">24</font>,  <font color="#c00058">24</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'d'</font>, <font color="#c00058">'D'</font>,   <font color="#c00058">4</font>,   <font color="#c00058">4</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'e'</font>, <font color="#c00058">'E'</font>,   <font color="#c00058">5</font>,   <font color="#c00058">5</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'4'</font>, <font color="#c00058">'$'</font>, <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'3'</font>, <font color="#c00058">'#'</font>, <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">' '</font>, <font color="#c00058">' '</font>, <font color="#c00058">' '</font>, <font color="#c00058">' '</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'v'</font>, <font color="#c00058">'V'</font>,  <font color="#c00058">22</font>,  <font color="#c00058">22</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'f'</font>, <font color="#c00058">'F'</font>,   <font color="#c00058">6</font>,   <font color="#c00058">6</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'t'</font>, <font color="#c00058">'T'</font>,  <font color="#c00058">20</font>,  <font color="#c00058">20</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'r'</font>, <font color="#c00058">'R'</font>,  <font color="#c00058">18</font>,  <font color="#c00058">18</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'5'</font>, <font color="#c00058">'%'</font>, <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'n'</font>, <font color="#c00058">'N'</font>,  <font color="#c00058">14</font>,  <font color="#c00058">14</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'b'</font>, <font color="#c00058">'B'</font>,   <font color="#c00058">2</font>,   <font color="#c00058">2</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'h'</font>, <font color="#c00058">'H'</font>,   <font color="#c00058">8</font>,   <font color="#c00058">8</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'g'</font>, <font color="#c00058">'G'</font>,   <font color="#c00058">7</font>,   <font color="#c00058">7</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'y'</font>, <font color="#c00058">'Y'</font>,  <font color="#c00058">25</font>,  <font color="#c00058">25</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'6'</font>, <font color="#c00058">'^'</font>, <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'m'</font>, <font color="#c00058">'M'</font>,  <font color="#c00058">13</font>,  <font color="#c00058">13</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'j'</font>, <font color="#c00058">'J'</font>,  <font color="#c00058">10</font>,  <font color="#c00058">10</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'u'</font>, <font color="#c00058">'U'</font>,  <font color="#c00058">21</font>,  <font color="#c00058">21</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'7'</font>, <font color="#c00058">'&amp;'</font>, <font color="#c00058">'7'</font>, <font color="#c00058">'7'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'8'</font>, <font color="#c00058">'*'</font>, <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">','</font>, <font color="#c00058">'&lt;'</font>, <font color="#c00058">','</font>, <font color="#c00058">','</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'k'</font>, <font color="#c00058">'K'</font>,  <font color="#c00058">11</font>,  <font color="#c00058">11</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'i'</font>, <font color="#c00058">'I'</font>,   <font color="#c00058">9</font>,   <font color="#c00058">9</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'o'</font>, <font color="#c00058">'O'</font>,  <font color="#c00058">15</font>,  <font color="#c00058">15</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'0'</font>, <font color="#c00058">')'</font>, <font color="#c00058">'0'</font>, <font color="#c00058">'0'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'9'</font>, <font color="#c00058">'('</font>, <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'.'</font>, <font color="#c00058">'&gt;'</font>, <font color="#c00058">'.'</font>, <font color="#c00058">'.'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'/'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'/'</font>, <font color="#c00058">'/'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'l'</font>, <font color="#c00058">'L'</font>,  <font color="#c00058">12</font>,  <font color="#c00058">12</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">';'</font>, <font color="#c00058">':'</font>, <font color="#c00058">';'</font>, <font color="#c00058">';'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'p'</font>, <font color="#c00058">'P'</font>,  <font color="#c00058">16</font>,  <font color="#c00058">16</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'-'</font>, <font color="#c00058">'_'</font>, <font color="#c00058">'-'</font>, <font color="#c00058">'-'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>        <font color="#c00058">39</font>, <font color="#c00058">'&quot;'</font>,  <font color="#c00058">39</font>,  <font color="#c00058">39</font>  <font color="#406090">; Single quote</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'['</font>, <font color="#c00058">'{'</font>, <font color="#c00058">'['</font>, <font color="#c00058">'['</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'='</font>, <font color="#c00058">'+'</font>, <font color="#c00058">'='</font>, <font color="#c00058">'='</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Caps lock</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Right shift</font>
        <font color="#cd00cd">DB</font>        <font color="#c00058">10</font>,  <font color="#c00058">10</font>,  <font color="#c00058">10</font>,  <font color="#c00058">10</font>  <font color="#406090">; Enter</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">']'</font>, <font color="#c00058">'}'</font>, <font color="#c00058">']'</font>, <font color="#c00058">']'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>        <font color="#c00058">92</font>, <font color="#c00058">'|'</font>,  <font color="#c00058">92</font>,  <font color="#c00058">92</font>  <font color="#406090">; Backslash</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>         <font color="#c00058">8</font>,   <font color="#c00058">8</font>,   <font color="#c00058">8</font>,   <font color="#c00058">8</font>  <font color="#406090">; Backspace</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>  <font color="#406090">; Numeric 1</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>, <font color="#c00058">'4'</font>  <font color="#406090">; Numeric 4</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'7'</font>, <font color="#c00058">'7'</font>, <font color="#c00058">'7'</font>, <font color="#c00058">'7'</font>  <font color="#406090">; Numeric 7</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'0'</font>, <font color="#c00058">'0'</font>, <font color="#c00058">'0'</font>, <font color="#c00058">'0'</font>  <font color="#406090">; Numeric 0</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'.'</font>, <font color="#c00058">'.'</font>, <font color="#c00058">'.'</font>, <font color="#c00058">'.'</font>  <font color="#406090">; Numeric .</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>, <font color="#c00058">'2'</font>  <font color="#406090">; Numeric 2</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>, <font color="#c00058">'5'</font>  <font color="#406090">; Numeric 5</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>, <font color="#c00058">'6'</font>  <font color="#406090">; Numeric 6</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>, <font color="#c00058">'8'</font>  <font color="#406090">; Numeric 8</font>
        <font color="#cd00cd">DB</font>        <font color="#c00058">27</font>,  <font color="#c00058">27</font>,  <font color="#c00058">27</font>,  <font color="#c00058">27</font>  <font color="#406090">; Escape</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Num lock</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>, <font color="#c00058">'1'</font>  <font color="#406090">; F11</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'+'</font>, <font color="#c00058">'+'</font>, <font color="#c00058">'+'</font>, <font color="#c00058">'+'</font>  <font color="#406090">; Numeric +</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>, <font color="#c00058">'3'</font>  <font color="#406090">; Numeric 3</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'-'</font>, <font color="#c00058">'-'</font>, <font color="#c00058">'-'</font>, <font color="#c00058">'-'</font>  <font color="#406090">; Numeric -</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'*'</font>, <font color="#c00058">'*'</font>, <font color="#c00058">'*'</font>, <font color="#c00058">'*'</font>  <font color="#406090">; Numeric *</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>, <font color="#c00058">'9'</font>  <font color="#406090">; Numeric 9</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>  <font color="#406090">; Scroll lock</font>
        <font color="#cd00cd">DB</font>       <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>, <font color="#c00058">'?'</font>

        <font color="#cd00cd">ORG</font>     <font color="#c00058">03F00H</font>
INTTABLE

        <font color="#406090">; IRQ0</font>
        <font color="#804040"><b>JP</b></font>      ISR0
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ1</font>
        <font color="#804040"><b>JP</b></font>      ISR1
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ2</font>
        <font color="#804040"><b>JP</b></font>      ISR2
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ3</font>
        <font color="#804040"><b>JP</b></font>      ISR3
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ4</font>
        <font color="#804040"><b>JP</b></font>      ISR4
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ5</font>
        <font color="#804040"><b>JP</b></font>      ISR5
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ6</font>
        <font color="#804040"><b>JP</b></font>      ISR6
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#406090">; IRQ7</font>
        <font color="#804040"><b>JP</b></font>      ISR7
        <font color="#cd00cd">DB</font>      <font color="#c00058">0</font>

        <font color="#cd00cd">ORG</font>     <font color="#c00058">04000H</font>

<font color="#cd00cd">#if </font><font color="#c00058">0</font>

<font color="#406090">; start tmp code</font>
        <font color="#cd00cd">ORG</font>     <font color="#c00058">06000H</font>  /* J UMP TO HERE */

<font color="#cd00cd">#if </font><font color="#c00058">0</font>
<font color="#406090">;this code writes 0-255 in 0x4000 through 0x40ff continuously</font>

        <font color="#804040"><b>DI</b></font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, <font color="#c00058">04000H</font>
TEST_WRITE_AGAIN
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">L</font>
        <font color="#804040"><b>JP</b></font>      TEST_WRITE_AGAIN
<font color="#cd00cd">#endif</font>


        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, <font color="#c00058">07000H</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">0</font>
TEST_AGAIN
        <font color="#804040"><b>PUSH</b></font>    <font color="#008080">HL</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (<font color="#008080">HL</font>)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">IX</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    PHEXBYTE
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), PAUSE
        <font color="#804040"><b>INC</b></font>     <font color="#008080">IX</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    LCDPRINT

<font color="#cd00cd">#if </font><font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, <font color="#c00058">04000H</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#c00058">0FFH</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, (<font color="#008080">HL</font>)
        <font color="#804040"><b>LD</b></font>      <font color="#008080">IX</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    PHEXBYTE
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), PAUSE
        <font color="#804040"><b>INC</b></font>     <font color="#008080">IX</font>
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">IX</font>), <font color="#c00058">0</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, OUTPUT_BUF
        <font color="#804040"><b>CALL</b></font>    LCDPRINT
<font color="#cd00cd">#endif</font>
        <font color="#804040"><b>POP</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">A</font>

        <font color="#804040"><b>JP</b></font>      TEST_AGAIN

<font color="#406090">; end tmp code</font>
<font color="#cd00cd">#endif</font>

<font color="#cd00cd">#if </font><font color="#c00058">1</font>
<font color="#cd00cd">#include </font><font color="#c00058">&quot;image.asm&quot;</font>
<font color="#cd00cd">#endif</font>

<font color="#cd00cd">#if </font><font color="#c00058">1</font>
        <font color="#cd00cd">ORG</font>     <font color="#c00058">09000H</font>   /* JUMP TO HERE */
<font color="#cd00cd">#endif</font>

<font color="#cd00cd">#if </font><font color="#c00058">0</font>
/* fill the screen */
        <font color="#804040"><b>LD</b></font>      <font color="#008080">HL</font>, <font color="#c00058">16384</font>
        <font color="#804040"><b>LD</b></font>      <font color="#008080">A</font>, <font color="#c00058">088H</font>

LOOP_AGAIN_YES
        <font color="#804040"><b>LD</b></font>      (<font color="#008080">HL</font>), <font color="#008080">A</font>
        <font color="#804040"><b>INC</b></font>     <font color="#008080">HL</font>
        <font color="#804040"><b>JP</b></font>      LOOP_AGAIN_YES
        <font color="#804040"><b>DJNZ</b></font>    LOOP_AGAIN_YES
<font color="#cd00cd">#endif</font>

<font color="#cd00cd">#if </font><font color="#c00058">0</font>
<font color="#cd00cd">#include </font><font color="#c00058">&quot;zcc_out.asm&quot;</font>
<font color="#cd00cd">#include </font><font color="#c00058">&quot;libc.asm&quot;</font>
<font color="#cd00cd">#endif</font>

LOOP_FOREVER
        <font color="#804040"><b>JP</b></font>      LOOP_FOREVER

        <font color="#cd00cd">END</font>
</pre>
</body>
</html>
